<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Trivia</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f6f6;
      padding: 20px;
    }
    h2 {
      margin-top: 40px;
    }
    .nivel-container {
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
    }
    label {
      font-weight: bold;
    }
    input, select, button, textarea {
      display: block;
      margin: 10px 0 20px;
      padding: 8px;
      width: 100%;
      max-width: 500px;
    }
    .pregunta-form {
      margin-top: 10px;
      padding: 10px;
      border-top: 1px solid #ccc;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Panel Administrador - Trivia</h1>

  <section>
    <h2>Editar Precios de Niveles</h2>
    <div id="niveles-container">
      <div class="nivel-container">
        <label for="precio-basico">Nivel Básico (ARS):</label>
        <input type="number" id="precio-basico" />
      </div>
      <div class="nivel-container">
        <label for="precio-medio">Nivel Medio (ARS):</label>
        <input type="number" id="precio-medio" />
      </div>
      <div class="nivel-container">
        <label for="precio-avanzado">Nivel Avanzado (ARS):</label>
        <input type="number" id="precio-avanzado" />
      </div>
      <button onclick="guardarPrecios()">Guardar Precios</button>
      <p id="precios-mensaje"></p>
    </div>
  </section>

  <section>
    <h2>Agregar Preguntas</h2>
    <form id="formulario-pregunta">
      <label for="nivel">Nivel:</label>
      <select id="nivel">
        <option value="basico">Básico</option>
        <option value="medio">Medio</option>
        <option value="avanzado">Avanzado</option>
      </select>

      <label for="texto-pregunta">Texto de la pregunta:</label>
      <textarea id="texto-pregunta" rows="3" required></textarea>

      <label>Opciones (3):</label>
      <input type="text" id="opcion1" placeholder="Opción 1" required />
      <input type="text" id="opcion2" placeholder="Opción 2" required />
      <input type="text" id="opcion3" placeholder="Opción 3" required />

      <label for="respuesta-correcta">Respuesta correcta (0, 1 o 2):</label>
      <select id="respuesta-correcta">
        <option value="0">Opción 1</option>
        <option value="1">Opción 2</option>
        <option value="2">Opción 3</option>
      </select>

      <button type="submit">Agregar Pregunta</button>
      <p id="pregunta-mensaje"></p>
    </form>
  </section>

  <script>
    const supabaseUrl = "https://ovulezkcxwrjvyxlxsdv.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dWxlemtjeHdyanZ5eGx4c2R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNzY5OTksImV4cCI6MjA2NDY1Mjk5OX0.ac82tkUR7AT0QVsuzuAGA8SXLkgnM9OX62meYNGnToI";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function cargarPrecios() {
      const { data, error } = await supabase.from('niveles_trivia').select('*');
      if (data) {
        data.forEach(nivel => {
          if (nivel.nivel === 'basico') document.getElementById('precio-basico').value = nivel.precio;
          if (nivel.nivel === 'medio') document.getElementById('precio-medio').value = nivel.precio;
          if (nivel.nivel === 'avanzado') document.getElementById('precio-avanzado').value = nivel.precio;
        });
      }
    }

    async function guardarPrecios() {
      const precios = {
        basico: parseInt(document.getElementById('precio-basico').value),
        medio: parseInt(document.getElementById('precio-medio').value),
        avanzado: parseInt(document.getElementById('precio-avanzado').value)
      };

      let errores = [];

      for (const nivel in precios) {
        const { error } = await supabase
          .from('niveles_trivia')
          .upsert([{ nivel: nivel, precio: precios[nivel] }], { onConflict: ['nivel'] });

        if (error) errores.push(`${nivel}: ${error.message}`);
      }

      const msg = document.getElementById('precios-mensaje');
      if (errores.length === 0) {
        msg.textContent = "Precios guardados correctamente.";
        msg.className = "success";
      } else {
        msg.textContent = "Error al guardar: " + errores.join(", ");
        msg.className = "error";
      }
    }

    document.getElementById("formulario-pregunta").addEventListener("submit", async function (e) {
      e.preventDefault();

      const nivel = document.getElementById("nivel").value;
      const texto = document.getElementById("texto-pregunta").value;
      const opciones = [
        document.getElementById("opcion1").value,
        document.getElementById("opcion2").value,
        document.getElementById("opcion3").value
      ];
      const correcta = parseInt(document.getElementById("respuesta-correcta").value);

      const { error } = await supabase.from("preguntas_trivia").insert({
        nivel, texto, opciones, correcta
      });

      const msg = document.getElementById("pregunta-mensaje");
      if (error) {
        msg.textContent = "Error al guardar pregunta: " + error.message;
        msg.className = "error";
      } else {
        msg.textContent = "Pregunta guardada exitosamente.";
        msg.className = "success";
        document.getElementById("formulario-pregunta").reset();
      }
    });

    cargarPrecios();
  </script>
}
        });

        document.getElementById("guardar-nivel").addEventListener("click", async () => {
          const nivel = document.getElementById("nivel-select").value;
          const precio = parseInt(document.getElementById("nuevo-precio").value);

          if (!nivel || isNaN(precio)) {
            alert("Completa todos los campos");
            return;
          }

          const { data, error } = await supabase
            .from("niveles_trivia")
            .upsert([{ nivel, precio }]);

          if (error) {
            alert("Error al guardar precio");
            return;
          }

          alert("Precio actualizado");
          cargarPrecios();
        });

        document.getElementById("guardar-pregunta").addEventListener("click", async () => {
          const nivel = document.getElementById("nivel-pregunta").value;
          const texto = document.getElementById("texto-pregunta").value.trim();
          const op1 = document.getElementById("op1").value.trim();
          const op2 = document.getElementById("op2").value.trim();
          const op3 = document.getElementById("op3").value.trim();
          const correcta = parseInt(document.getElementById("correcta").value);

          if (!nivel || !texto || !op1 || !op2 || !op3 || isNaN(correcta)) {
            alert("Completa todos los campos");
            return;
          }

          const opciones = [op1, op2, op3];

          const { error } = await supabase.from("preguntas_trivia").insert([
            {
              nivel,
              texto,
              opciones,
              correcta,
            },
          ]);

          if (error) {
            alert("Error al guardar la pregunta");
            return;
          }

          alert("Pregunta guardada");
          document.getElementById("texto-pregunta").value = "";
          document.getElementById("op1").value = "";
          document.getElementById("op2").value = "";
          document.getElementById("op3").value = "";
          document.getElementById("correcta").value = "";
          cargarPreguntas(nivel);
        });

        document.getElementById("nivel-pregunta").addEventListener("change", (e) => {
          cargarPreguntas(e.target.value);
        });

        cargarPrecios();
        cargarRanking();
        cargarPremios();
      </script>
    </div>
  </div>
</body>
</html>
