<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trivia - Admin</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #58a6ff;
    }
    .seccion {
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      background-color: #161b22;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: none;
      background-color: #21262d;
      color: #c9d1d9;
    }
    button {
      background-color: #238636;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background-color: #2ea043;
    }
    .pregunta {
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #30363d;
      border-radius: 5px;
      background-color: #0d1117;
    }
  </style>
</head>
<body>

  <h1>Administrar Trivia</h1>

  <div class="seccion">
    <h2>Agregar Pregunta</h2>
    <label for="nivel-pregunta">Nivel</label>
    <select id="nivel-pregunta">
      <option value="basico">Básico</option>
      <option value="medio">Medio</option>
      <option value="avanzado">Avanzado</option>
    </select>

    <label for="texto-pregunta">Texto de la pregunta</label>
    <input type="text" id="texto-pregunta" />

    <label for="op1">Opción 1</label>
    <input type="text" id="op1" />

    <label for="op2">Opción 2</label>
    <input type="text" id="op2" />

    <label for="op3">Opción 3</label>
    <input type="text" id="op3" />

    <label for="correcta">Número de opción correcta (1, 2 o 3)</label>
    <input type="number" id="correcta" min="1" max="3" />

    <button id="guardar-pregunta">Guardar Pregunta</button>

    <h3>Preguntas guardadas</h3>
    <div id="lista-preguntas"></div>
  </div>

  <div class="seccion">
    <h2>Precios por Nivel</h2>

    <label for="nivel-select">Nivel</label>
    <select id="nivel-select">
      <option value="basico">Básico</option>
      <option value="medio">Medio</option>
      <option value="avanzado">Avanzado</option>
    </select>

    <label for="nuevo-precio">Nuevo precio</label>
    <input type="number" id="nuevo-precio" />

    <button id="guardar-nivel">Guardar Precio</button>

    <h3>Precios actuales</h3>
    <div id="lista-precios"></div>
  </div>

  <script>
    const supabaseUrl = "https://ovulezkcxwrjvyxlxsdv.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dWxlemtjeHdyanZ5eGx4c2R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNzY5OTksImV4cCI6MjA2NDY1Mjk5OX0.ac82tkUR7AT0QVsuzuAGA8SXLkgnM9OX62meYNGnToI";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);
  </script>
</select>
        <button id="guardar-nivel">Guardar precio</button>
      </div>

      <div class="seccion">
        <h3>Agregar pregunta</h3>
        <select id="nivel-pregunta">
          <option value="facil">Fácil</option>
          <option value="intermedio">Intermedio</option>
          <option value="dificil">Difícil</option>
        </select><br><br>
        <textarea id="texto-pregunta" placeholder="Escribe la pregunta..."></textarea><br>
        <input type="text" id="op1" placeholder="Opción 1" />
        <input type="text" id="op2" placeholder="Opción 2" />
        <input type="text" id="op3" placeholder="Opción 3" />
        <input type="number" id="correcta" placeholder="Índice correcta (0,1,2)" min="0" max="2" />
        <button id="guardar-pregunta">Guardar pregunta</button>
      </div>

      <div class="seccion">
        <h3>Preguntas cargadas</h3>
        <ul id="lista-preguntas"></ul>
      </div>

      <div class="seccion">
        <h3>Ranking</h3>
        <table>
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Puntaje</th>
            </tr>
          </thead>
          <tbody id="ranking-trivia"></tbody>
        </table>
      </div>

      <div class="seccion">
        <h3>Premios trivia</h3>
        <table>
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Monto</th>
              <th>Moneda</th>
              <th>Fecha</th>
              <th>Aprobado</th>
            </tr>
          </thead>
          <tbody id="premios-trivia"></tbody>
        </table>
      </div>
    </div>

    <script>
      const supabaseUrl = "https://ovulezkcxwrjvyxlxsdv.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dWxlemtjeHdyanZ5eGx4c2R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNzY5OTksImV4cCI6MjA2NDY1Mjk5OX0.ac82tkUR7AT0QVsuzuAGA8SXLkgnM9OX62meYNGnToI";
      const supabase = supabase.createClient(supabaseUrl, supabaseKey);

      async function cargarPrecios() {
        const { data } = await supabase.from("niveles_trivia").select("*");
        const lista = document.getElementById("lista-precios");
        lista.innerHTML = "";
        data.forEach(({ nivel, precio }) => {
          const item = document.createElement("li");
          item.textContent = `${nivel}: $${precio}`;
          lista.appendChild(item);
        });
      }

      document.getElementById("guardar-nivel").addEventListener("click", async () => {
        const nivel = document.getElementById("nivel-select").value;
        const precio = parseInt(document.getElementById("nuevo-precio").value);
        if (!nivel || isNaN(precio)) {
          alert("Completa todos los campos");
          return;
        }
        const { error } = await supabase.from("niveles_trivia").upsert([{ nivel, precio }]);
        if (error) {
          alert("Error al guardar precio");
          return;
        }
        alert("Precio actualizado");
        cargarPrecios();
      });

      document.getElementById("guardar-pregunta").addEventListener("click", async () => {
        const nivel = document.getElementById("nivel-pregunta").value;
        const texto = document.getElementById("texto-pregunta").value.trim();
        const op1 = document.getElementById("op1").value.trim();
        const op2 = document.getElementById("op2").value.trim();
        const op3 = document.getElementById("op3").value.trim();
        const correcta = parseInt(document.getElementById("correcta").value);
        if (!nivel || !texto || !op1 || !op2 || !op3 || isNaN(correcta)) {
          alert("Completa todos los campos");
          return;
        }
        const opciones = [op1, op2, op3];
        const { error } = await supabase.from("preguntas_trivia").insert([
          { nivel, texto, opciones, correcta }
        ]);
        if (error) {
          alert("Error al guardar la pregunta");
          return;
        }
        alert("Pregunta guardada");
        document.getElementById("texto-pregunta").value = "";
        document.getElementById("op1").value = "";
        document.getElementById("op2").value = "";
        document.getElementById("op3").value = "";
        document.getElementById("correcta").value = "";
        cargarPreguntas(nivel);
      });

      async function cargarPreguntas(nivel) {
        const { data } = await supabase
          .from("preguntas_trivia")
          .select("*")
          .eq("nivel", nivel);
        const lista = document.getElementById("lista-preguntas");
        lista.innerHTML = "";
        data.forEach(p => {
          const li = document.createElement("li");
          li.textContent = `${p.texto} (${p.opciones.join(", ")}) [Correcta: ${p.correcta}]`;
          lista.appendChild(li);
        });
      }

      document.getElementById("nivel-pregunta").addEventListener("change", (e) => {
        cargarPreguntas(e.target.value);
      });

      async function cargarRanking() {
        const { data } = await supabase
          .from("ranking_trivia")
          .select("usuario_id, puntaje")
          .order("puntaje", { ascending: false });
        const tabla = document.getElementById("ranking-trivia");
        tabla.innerHTML = "";
        data.forEach(({ usuario_id, puntaje }) => {
          const fila = document.createElement("tr");
          fila.innerHTML = `<td>${usuario_id}</td><td>${puntaje}</td>`;
          tabla.appendChild(fila);
        });
      }

      async function cargarPremios() {
        const { data } = await supabase
          .from("recompensas")
          .select("*")
          .eq("tipo", "trivia")
          .order("fecha", { ascending: false });
        const tabla = document.getElementById("premios-trivia");
        tabla.innerHTML = "";
        data.forEach(p => {
          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>${p.usuario_id}</td>
            <td>${p.monto}</td>
            <td>${p.moneda}</td>
            <td>${new Date(p.fecha).toLocaleDateString()}</td>
            <td>${p.aprobado ? "✅" : "❌"}</td>
          `;
          tabla.appendChild(fila);
        });
      }

      cargarPrecios();
      cargarRanking();
      cargarPremios();
      cargarPreguntas(document.getElementById("nivel-pregunta").value);
    </script>
  </body>
</html>
